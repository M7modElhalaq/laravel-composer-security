language: php

matrix:
  fast_finish: true
  include:
  - php: 5.5
    env: LARAVEL_VERSION=5.0
  - php: 5.5
    env: LARAVEL_VERSION=5.1
  - php: 5.6
    env: LARAVEL_VERSION=5.0
  - php: 5.6
    env: LARAVEL_VERSION=5.1
  - php: 5.6
    env: LARAVEL_VERSION=5.2.23
  - php: 7.0
    env: LARAVEL_VERSION=5.0
  - php: 7.0
    env: LARAVEL_VERSION=5.1
  - php: 7.0
    env: LARAVEL_VERSION=5.2.23
  - php: 7.0
    env: LARAVEL_VERSION=5.3
  - php: 7.1
    env: LARAVEL_VERSION=5.1
  - php: 7.1
    env: LARAVEL_VERSION=5.2.23
  - php: 7.1
    env: LARAVEL_VERSION=5.3

  allow_failures:
  - php: 5.4
    env: LARAVEL_VERSION=5.0
  - php: 5.5
    env: LARAVEL_VERSION=5.0
  - php: 5.6
    env: LARAVEL_VERSION=5.0
  - php: 7.0
    env: LARAVEL_VERSION=5.0
  - php: 7.1
    env: LARAVEL_VERSION=5.0

before_install:
- composer self-update
- if [[ $LARAVEL_VERSION != '5.3' ]]; then composer create-project laravel/laravel:$LARAVEL_VERSION;
  fi
- if [[ $LARAVEL_VERSION == '5.3' ]]; then composer create-project laravel/laravel:$LARAVEL_VERSION
  --stability dev; fi
- composer update
- cd ./laravel
- if [[ $LARAVEL_VERSION != '5.3' ]]; then composer require padosoft/laravel-test:1.*;
  fi
- if [[ $LARAVEL_VERSION == '5.3' && $TRAVIS_PHP_VERSION == 7.0 ]]; then composer
  require padosoft/laravel-test:2.*; fi
- if [[ $LARAVEL_VERSION == '5.3' && $TRAVIS_PHP_VERSION == 7.1 ]]; then composer
  require padosoft/laravel-test:2.*; fi
- composer require padosoft/laravel-composer-security dev-master
- if [[ $LARAVEL_VERSION == '5.0' ]]; then composer require mockery/mockery; fi
- chmod 777 -R ./
- "./vendor/padosoft/laravel-composer-security/tests/config/sedCommand.sh"
- composer update
- "./vendor/padosoft/laravel-composer-security/tests/config/sedCommandProvider.sh"
- rm ./.env
- cp ./vendor/padosoft/laravel-composer-security/tests/config/.env.dist ./.env
- php artisan vendor:publish
- rvm 1.9.3 do gem install mime-types -v 2.6.2
- gem install mailcatcher
- mailcatcher
script:
- vendor/bin/phpunit --configuration ./vendor/padosoft/laravel-composer-security/phpunit.xml.dist --testsuite Package --coverage-text --coverage-clover=coverage.clover

after_script:
- wget https://scrutinizer-ci.com/ocular.phar
- if [[ $TRAVIS_PHP_VERSION != '7.0' && $TRAVIS_PHP_VERSION != '7.1' ]]; then php ocular.phar code-coverage:upload --access-token="93bdd4aee7a5446ac53fe372f1526b6a3d8af949ec675ab1963ca12398a4eebd" --format=php-clover coverage.clover; fi

notifications:
  email:
    - helpdesk@padosoft.com
  slack:
    secure: w2TArNwrtSRHSGEV8FBLmiVlGL3/vLwthmFTZMEFa176/NX91lBsc/AUVpxW9VQBuPag1bLnOOkvBfXq36vh/m/ZmatnCKCeu24GFa9SbTsD39ApsWulMnJ1pYDtf12GD4G3y5B7R55vuKx22NXtXgXpjWS9GHsvtQGU6TkKrvdnEjSl60JmCoNtnKcuJRihAXMRBs1WjTcny73kxzINt/PcaKJ4s+v5CSCX18Gp3wM2tBBsG1R1ywmOPNoJ7vQ+pNTd3Exj/2YK4hEoqeVluiMNjtJdvgLmcc7V5stOdo06Aw9H5VKYZ08CyhGj245QEkFLER6bBpdRMQuYFYRrEugaZishciQV6Gu3+9EGPYWoaDvF9XhWPahqpxX0JMC/kfScouTyACMbwoDAxRoJLmxZWEXtdlW1K61vsaEZwhk9krrYqOsuBwp/Xqtr8q5wUehN5q9bWoXVnZN7RMYp/BZoGSvfYXTSbBji/nnNfOsrPA1RbF8iQl5ClfST8lPCoD+glAiixgO9kPG4fg3nxHxqora6/OpB6WlzTBE5hUs6EsXsWh/UgILL4eDXyPSs/afN/h3ZMAUJrqnFFowZSpQIS9Q12/n8UnIu9Vi8qKeGBwhLmJ5cE/ILf4TVWczEPxd5u9H8N0D/5Z8wlxI6uUGBYvl6us4PIpAX/cT3hjY=
